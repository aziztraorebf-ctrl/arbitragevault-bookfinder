# Phase 12.1 - Mobile UX Fixes Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Fix 4 critical mobile UX issues identified during manual validation: non-clickable action cards, Niche Discovery layout overflow, illegible tables, and CSV drop zone cutoff.

**Architecture:**
- Task 1: Add `useNavigate` to Dashboard action cards for navigation
- Task 2: Fix NicheDiscovery page padding/overflow with responsive classes
- Task 3: Implement Option B+ (priority columns + expand row) in UnifiedProductTable/Row
- Task 4: Adjust CSV drop zone responsive sizing in AnalyseManuelle

**Tech Stack:** React 18, TypeScript, Tailwind CSS, react-router-dom

---

## Task 1: Make Dashboard Action Cards Clickable

**Files:**
- Modify: `frontend/src/components/Dashboard/Dashboard.tsx:1-197`

**Step 1: Add useNavigate import**

Add at line 1:
```typescript
import { useState } from 'react'
import { useNavigate } from 'react-router-dom'
import type { KeepaHealthResponse } from '../../types/keepa'
```

**Step 2: Add navigate hook inside component**

Add after line 20 (after the error state):
```typescript
  const navigate = useNavigate()
```

**Step 3: Update Card 1 - Analyser Manuellement**

Replace lines 142-153 with:
```typescript
        {/* Card 1: Analyser Manuellement */}
        <div
          onClick={() => navigate('/analyse')}
          className="h-56 bg-gradient-to-br from-blue-500 to-blue-600 rounded-3xl text-white p-8 flex flex-col justify-between cursor-pointer hover:shadow-xl transition-shadow duration-200 active:scale-[0.98]"
          role="button"
          tabIndex={0}
          onKeyDown={(e) => e.key === 'Enter' && navigate('/analyse')}
        >
          <div className="text-4xl">üìÑ</div>
          <div>
            <h3 className="text-xl font-bold mb-2">
              Analyser<br />Manuellement
            </h3>
            <p className="text-sm text-white/80">
              (CSV/ASINs)
            </p>
          </div>
        </div>
```

**Step 4: Update Card 2 - Decouvrir**

Replace lines 155-166 with:
```typescript
        {/* Card 2: Decouvrir */}
        <div
          onClick={() => navigate('/niche-discovery')}
          className="h-56 bg-gradient-to-br from-purple-500 to-purple-600 rounded-3xl text-white p-8 flex flex-col justify-between cursor-pointer hover:shadow-xl transition-shadow duration-200 active:scale-[0.98]"
          role="button"
          tabIndex={0}
          onKeyDown={(e) => e.key === 'Enter' && navigate('/niche-discovery')}
        >
          <div className="text-4xl">üîç</div>
          <div>
            <h3 className="text-xl font-bold mb-2">
              Decouvrir
            </h3>
            <p className="text-sm text-white/80">
              Nouvelles Niches
            </p>
          </div>
        </div>
```

**Step 5: Update Card 3 - Mes Niches**

Replace lines 168-181 with:
```typescript
        {/* Card 3: Mes Niches */}
        <div
          onClick={() => navigate('/mes-niches')}
          className="h-56 bg-gradient-to-br from-green-500 to-green-600 rounded-3xl text-white p-8 flex flex-col justify-between cursor-pointer hover:shadow-xl transition-shadow duration-200 active:scale-[0.98]"
          role="button"
          tabIndex={0}
          onKeyDown={(e) => e.key === 'Enter' && navigate('/mes-niches')}
        >
          <div className="text-4xl">üìö</div>
          <div>
            <h3 className="text-xl font-bold mb-2">
              Mes Niches
            </h3>
            <p className="text-sm text-white/80">
              Sauvegardees<br />
              (23)
            </p>
          </div>
        </div>
```

**Step 6: Run build to verify no TypeScript errors**

Run: `cd frontend && npm run build`
Expected: Build successful with no errors

**Step 7: Commit**

```bash
git add frontend/src/components/Dashboard/Dashboard.tsx
git commit -m "feat(mobile): make Dashboard action cards clickable with navigation"
```

---

## Task 2: Fix Niche Discovery Mobile Layout

**Files:**
- Modify: `frontend/src/pages/NicheDiscovery.tsx:123-124`

**Step 1: Fix page container padding for mobile**

Replace line 124:
```typescript
    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-purple-50 to-blue-50 p-8">
```

With:
```typescript
    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-purple-50 to-blue-50 p-4 md:p-8">
```

**Step 2: Fix max-w container for mobile overflow**

Replace line 126:
```typescript
      <div className="max-w-7xl mx-auto mb-8">
```

With:
```typescript
      <div className="max-w-7xl mx-auto mb-4 md:mb-8 overflow-x-hidden">
```

**Step 3: Fix header text size for mobile**

Replace lines 129-134:
```typescript
            <h1 className="text-4xl font-bold text-gray-900 mb-2">
              Niche Discovery
            </h1>
            <p className="text-gray-600 text-lg">
              Decouvrez des niches rentables en un clic ou personnalisez votre recherche
            </p>
```

With:
```typescript
            <h1 className="text-2xl md:text-4xl font-bold text-gray-900 mb-2">
              Niche Discovery
            </h1>
            <p className="text-gray-600 text-sm md:text-lg">
              Decouvrez des niches rentables en un clic ou personnalisez votre recherche
            </p>
```

**Step 4: Fix main content container**

Replace line 140:
```typescript
      <div className="max-w-7xl mx-auto space-y-8">
```

With:
```typescript
      <div className="max-w-7xl mx-auto space-y-6 md:space-y-8 overflow-x-hidden">
```

**Step 5: Run build to verify**

Run: `cd frontend && npm run build`
Expected: Build successful

**Step 6: Commit**

```bash
git add frontend/src/pages/NicheDiscovery.tsx
git commit -m "fix(mobile): improve NicheDiscovery padding and overflow for mobile"
```

---

## Task 3: Implement Mobile-Friendly Tables (Option B+)

This is the most complex task - implementing priority columns with expand row for mobile.

**Files:**
- Modify: `frontend/src/components/unified/UnifiedProductTable.tsx`
- Modify: `frontend/src/components/unified/UnifiedProductRow.tsx`

### Step 3.1: Update UnifiedProductTable for mobile

**Step 3.1.1: Remove min-width constraint on mobile**

In `UnifiedProductTable.tsx`, replace line 263:
```typescript
        <table className="w-full min-w-[800px]">
```

With:
```typescript
        <table className="w-full md:min-w-[800px]">
```

**Step 3.1.2: Add mobile expand column header**

After line 266 (after showAccordion th), add:
```typescript
              {/* Mobile expand button - only visible on mobile */}
              <th className="md:hidden px-2 py-3 w-10"></th>
```

**Step 3.1.3: Hide non-essential columns on mobile (headers)**

Update the following column headers to add `hidden md:table-cell`:

For Score header (around line 278-282):
```typescript
              {showScore && (
                <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                  Score
                </th>
              )}
```

For Velocity header (around line 286-288):
```typescript
              <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                Velocity
              </th>
```

For BSR header (around line 289-291):
```typescript
              <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                BSR
              </th>
```

For Rank header (around line 267-271):
```typescript
              {showRank && (
                <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                  Rank
                </th>
              )}
```

For Recommendation header (around line 292-297):
```typescript
              {showRecommendation && (
                <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                  <span className="hidden md:inline">Recommandation</span>
                  <span className="md:hidden">Reco</span>
                </th>
              )}
```

For Amazon badges header (around line 298-303):
```typescript
              {showAmazonBadges && (
                <th className="hidden md:table-cell px-3 md:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase whitespace-nowrap">
                  <span className="hidden md:inline">Amazon</span>
                  <span className="md:hidden">Amz</span>
                </th>
              )}
```

**Step 3.1.4: Pass mobile expand state to row**

Update the UnifiedProductRow call (around line 318-335) to add `isMobileExpanded` prop:
```typescript
                <UnifiedProductRow
                  key={product.asin}
                  product={product}
                  isExpanded={expandedRow === product.asin}
                  onToggle={() => setExpandedRow(expandedRow === product.asin ? null : product.asin)}
                  features={rowFeatures}
                  onVerify={onVerify}
                  verificationLoading={verificationState?.loading}
                  verificationResult={verificationState?.result}
                  verificationError={verificationState?.error}
                  isVerificationExpanded={isVerificationExpanded?.(product.asin)}
                  onToggleVerification={() => toggleVerificationExpansion?.(product.asin)}
                  AccordionComponent={AccordionComponent}
                  isMobileExpanded={expandedRow === product.asin}
                  onMobileToggle={() => setExpandedRow(expandedRow === product.asin ? null : product.asin)}
                />
```

### Step 3.2: Update UnifiedProductRow for mobile expand

**Step 3.2.1: Add new props to interface**

In `UnifiedProductRow.tsx`, update the interface (around line 22-34):
```typescript
interface UnifiedProductRowProps {
  product: DisplayableProduct
  isExpanded: boolean
  onToggle: () => void
  features: UnifiedRowFeatures
  onVerify?: (product: DisplayableProduct) => void
  verificationLoading?: boolean
  verificationResult?: VerificationResponse
  verificationError?: string
  isVerificationExpanded?: boolean
  onToggleVerification?: () => void
  AccordionComponent?: React.ComponentType<{ product: DisplayableProduct; isExpanded: boolean }>
  // Mobile expand props
  isMobileExpanded?: boolean
  onMobileToggle?: () => void
}
```

**Step 3.2.2: Destructure new props**

Update the function parameters (around line 44-56):
```typescript
export function UnifiedProductRow({
  product,
  isExpanded,
  onToggle,
  features,
  onVerify,
  verificationLoading,
  verificationResult,
  verificationError,
  isVerificationExpanded,
  onToggleVerification,
  AccordionComponent,
  isMobileExpanded = false,
  onMobileToggle,
}: UnifiedProductRowProps) {
```

**Step 3.2.3: Add mobile expand button column**

After the showAccordion td (around line 102), add:
```typescript
        {/* Mobile expand button - visible only on mobile */}
        <td className="md:hidden px-2 py-3 text-center">
          <button
            onClick={onMobileToggle}
            className="p-2 text-gray-500 hover:text-gray-700 transition-transform min-h-[44px] min-w-[44px] flex items-center justify-center"
            aria-label={isMobileExpanded ? 'Collapse details' : 'Expand details'}
          >
            <svg
              className={`w-5 h-5 transition-transform duration-300 ${isMobileExpanded ? 'rotate-180' : ''}`}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
          </button>
        </td>
```

**Step 3.2.4: Hide non-essential columns on mobile (cells)**

Update the following cells to add `hidden md:table-cell`:

For Rank cell (around line 105-109):
```typescript
        {showRank && (
          <td className="hidden md:table-cell px-4 py-3 text-center text-sm font-medium text-gray-900">
            {product.rank ?? '-'}
          </td>
        )}
```

For Score cell (around line 133-138):
```typescript
        {showScore && (
          <td className="hidden md:table-cell px-4 py-3 text-center text-sm font-bold text-purple-600">
            {product.score?.toFixed(1) ?? '-'}
          </td>
        )}
```

For Velocity cell (around line 145-158):
```typescript
        <td className="hidden md:table-cell px-4 py-3 text-center">
          <div className="flex items-center justify-center space-x-2">
            <span className="text-sm font-medium text-gray-900">
              {product.velocity_score.toFixed(0)}
            </span>
            <div className="w-16 bg-gray-200 rounded-full h-2">
              <div
                className="bg-blue-500 h-2 rounded-full transition-all"
                style={{ width: `${Math.min(product.velocity_score, 100)}%` }}
              />
            </div>
          </div>
        </td>
```

For BSR cell (around line 160-163):
```typescript
        <td className="hidden md:table-cell px-4 py-3 text-center text-sm font-medium text-gray-700">
          {product.bsr ? `#${product.bsr.toLocaleString()}` : 'N/A'}
        </td>
```

For Recommendation cell (around line 165-178):
```typescript
        {showRecommendation && (
          <td className="hidden md:table-cell px-4 py-3 text-center">
            {recommendationBadge ? (
              <span
                className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${recommendationBadge.color}`}
              >
                {recommendationBadge.label}
              </span>
            ) : (
              <span className="text-gray-400">-</span>
            )}
          </td>
        )}
```

For Amazon badges cell (around line 180-196):
```typescript
        {showAmazonBadges && (
          <td className="hidden md:table-cell px-4 py-3 text-center">
            <div className="flex gap-1 justify-center">
              {product.amazon_on_listing && (
                <span className="px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">
                  AMZ
                </span>
              )}
              {product.amazon_buybox && (
                <span className="px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded">
                  BB
                </span>
              )}
            </div>
          </td>
        )}
```

**Step 3.2.5: Add mobile expand row with details**

Before the Accordion row (around line 238), add:
```typescript
      {/* Mobile expand details row - visible only on mobile when expanded */}
      {isMobileExpanded && (
        <tr className="md:hidden bg-gray-50 border-t border-gray-200">
          <td colSpan={20} className="px-4 py-3">
            <div className="grid grid-cols-2 gap-3 text-sm">
              {/* Velocity */}
              <div>
                <span className="text-gray-500 text-xs">Velocity</span>
                <div className="flex items-center gap-2 mt-1">
                  <span className="font-medium">{product.velocity_score.toFixed(0)}</span>
                  <div className="w-12 bg-gray-200 rounded-full h-1.5">
                    <div
                      className="bg-blue-500 h-1.5 rounded-full"
                      style={{ width: `${Math.min(product.velocity_score, 100)}%` }}
                    />
                  </div>
                </div>
              </div>

              {/* BSR */}
              <div>
                <span className="text-gray-500 text-xs">BSR</span>
                <p className="font-medium mt-1">
                  {product.bsr ? `#${product.bsr.toLocaleString()}` : 'N/A'}
                </p>
              </div>

              {/* Score (if applicable) */}
              {features.showScore && product.score !== undefined && (
                <div>
                  <span className="text-gray-500 text-xs">Score</span>
                  <p className="font-medium text-purple-600 mt-1">{product.score.toFixed(1)}</p>
                </div>
              )}

              {/* Rank (if applicable) */}
              {features.showRank && product.rank !== undefined && (
                <div>
                  <span className="text-gray-500 text-xs">Rank</span>
                  <p className="font-medium mt-1">#{product.rank}</p>
                </div>
              )}

              {/* Recommendation (if applicable) */}
              {features.showRecommendation && recommendationBadge && (
                <div className="col-span-2">
                  <span className="text-gray-500 text-xs">Recommandation</span>
                  <p className="mt-1">
                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-semibold ${recommendationBadge.color}`}>
                      {recommendationBadge.label}
                    </span>
                  </p>
                </div>
              )}

              {/* Amazon badges (if applicable) */}
              {features.showAmazonBadges && (product.amazon_on_listing || product.amazon_buybox) && (
                <div className="col-span-2">
                  <span className="text-gray-500 text-xs">Amazon</span>
                  <div className="flex gap-2 mt-1">
                    {product.amazon_on_listing && (
                      <span className="px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded">AMZ</span>
                    )}
                    {product.amazon_buybox && (
                      <span className="px-2 py-0.5 bg-yellow-100 text-yellow-700 text-xs rounded">BB</span>
                    )}
                  </div>
                </div>
              )}
            </div>
          </td>
        </tr>
      )}
```

**Step 3.3: Run build to verify**

Run: `cd frontend && npm run build`
Expected: Build successful

**Step 3.4: Run unit tests**

Run: `cd frontend && npm run test -- --run`
Expected: All tests pass

**Step 3.5: Commit**

```bash
git add frontend/src/components/unified/UnifiedProductTable.tsx frontend/src/components/unified/UnifiedProductRow.tsx
git commit -m "feat(mobile): implement priority columns with expand row for mobile tables"
```

---

## Task 4: Fix CSV Drop Zone Mobile Layout

**Files:**
- Modify: `frontend/src/pages/AnalyseManuelle.tsx:219-245`

**Step 1: Fix grid layout for mobile**

Replace line 219:
```typescript
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
```

With:
```typescript
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
```

**Step 2: Fix CSV drop zone sizing for mobile**

Replace lines 221-225:
```typescript
        <div
          className="bg-white rounded-2xl p-8 border-2 border-dashed border-blue-300 hover:border-blue-500 transition-all duration-200 flex flex-col items-center justify-center min-h-[320px] cursor-pointer group"
          onDragOver={handleDragOver}
          onDrop={handleDrop}
          onClick={() => fileInputRef.current?.click()}
        >
```

With:
```typescript
        <div
          className="bg-white rounded-2xl p-4 md:p-8 border-2 border-dashed border-blue-300 hover:border-blue-500 transition-all duration-200 flex flex-col items-center justify-center min-h-[200px] md:min-h-[320px] cursor-pointer group"
          onDragOver={handleDragOver}
          onDrop={handleDrop}
          onClick={() => fileInputRef.current?.click()}
        >
```

**Step 3: Fix icon size for mobile**

Replace line 235:
```typescript
            <div className="text-6xl mb-4">‚òÅÔ∏è</div>
```

With:
```typescript
            <div className="text-4xl md:text-6xl mb-2 md:mb-4">‚òÅÔ∏è</div>
```

**Step 4: Fix ASIN card padding for mobile**

Replace line 248:
```typescript
        <div className="bg-white rounded-2xl p-8 shadow-md flex flex-col gap-4">
```

With:
```typescript
        <div className="bg-white rounded-2xl p-4 md:p-8 shadow-md flex flex-col gap-4">
```

**Step 5: Fix textarea height for mobile**

Replace line 253:
```typescript
            className="w-full h-32 p-4 border border-gray-300 rounded-lg resize-none focus:outline-none focus:border-blue-500 text-sm"
```

With:
```typescript
            className="w-full h-24 md:h-32 p-3 md:p-4 border border-gray-300 rounded-lg resize-none focus:outline-none focus:border-blue-500 text-sm"
```

**Step 6: Fix page title for mobile**

Replace line 207:
```typescript
      <h1 className="text-3xl font-bold text-gray-900">
```

With:
```typescript
      <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
```

**Step 7: Run build to verify**

Run: `cd frontend && npm run build`
Expected: Build successful

**Step 8: Commit**

```bash
git add frontend/src/pages/AnalyseManuelle.tsx
git commit -m "fix(mobile): adjust CSV drop zone and layout for mobile screens"
```

---

## Task 5: Final Build Verification

**Step 1: Run full build**

Run: `cd frontend && npm run build`
Expected: Build successful with no errors

**Step 2: Run lint**

Run: `cd frontend && npm run lint`
Expected: No new errors (existing warnings acceptable)

**Step 3: Run all unit tests**

Run: `cd frontend && npm run test -- --run`
Expected: All tests pass

**Step 4: Final commit with all changes**

```bash
git add -A
git commit -m "chore(phase12.1): complete mobile UX fixes - action cards, niche discovery, tables, csv zone"
```

**Step 5: Push to remote**

```bash
git push origin main
```

---

## Summary of Changes

| Task | File | Change |
|------|------|--------|
| 1 | Dashboard.tsx | Add useNavigate, onClick handlers to action cards |
| 2 | NicheDiscovery.tsx | Fix padding, overflow, text sizes for mobile |
| 3 | UnifiedProductTable.tsx | Hide columns on mobile, add expand column |
| 3 | UnifiedProductRow.tsx | Add mobile expand row with all details |
| 4 | AnalyseManuelle.tsx | Fix CSV zone sizing, padding for mobile |

## Testing Checklist

- [ ] Action cards navigate correctly on mobile
- [ ] Niche Discovery doesn't overflow horizontally on 375px viewport
- [ ] Tables show ASIN, Title, ROI + expand button on mobile
- [ ] Expand button reveals hidden columns in compact format
- [ ] CSV drop zone fits on mobile without cutoff
- [ ] All existing functionality preserved on desktop
